___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "CLIENT",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "File Proxy",
  "brand": {
    "id": "brand_dummy",
    "displayName": "Stape",
    "thumbnail": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QCwRXhpZgAATU0AKgAAAAgABgESAAMAAAABAAEAAAEaAAUAAAABAAAAVgEbAAUAAAABAAAAXgEoAAMAAAABAAIAAAE7AAIAAAAYAAAAZodpAAQAAAABAAAAfgAAAAAAAABIAAAAAQAAAEgAAAABVmVjdG9yU3RvY2suY29tLzY4MDU1NzIAAAOgAQADAAAAAQABAACgAgAEAAAAAQAAAKWgAwAEAAAAAQAAAKUAAAAA/+EJuGh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8APD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iPiA8ZGM6Y3JlYXRvcj4gPHJkZjpTZXE+IDxyZGY6bGk+VmVjdG9yU3RvY2suY29tLzY4MDU1NzI8L3JkZjpsaT4gPC9yZGY6U2VxPiA8L2RjOmNyZWF0b3I+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDw/eHBhY2tldCBlbmQ9InciPz4A/+0AZFBob3Rvc2hvcCAzLjAAOEJJTQQEAAAAAAArHAFaAAMbJUccAgAAAgACHAJQABdWZWN0b3JTdG9jay5jb20vNjgwNTU3MgA4QklNBCUAAAAAABAz+BZERuTlkL0PgjapSdEw/8AAEQgApQClAwERAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/bAEMAAwICAwICAwMDAwQDAwQFCAUFBAQFCgcHBggMCgwMCwoLCw0OEhANDhEOCwsQFhARExQVFRUMDxcYFhQYEhQVFP/bAEMBAwQEBQQFCQUFCRQNCw0UFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFP/dAAQAFf/aAAwDAQACEQMRAD8A/VKgAoAKACgAoAazYbrQByfxI+LPhH4P+G5te8aeIbDw5pUfAuL6YL5h67UX7zt/sqCfagD89vjf/wAFpNE0mW4sPhZ4Rl12RflXWPEJNvbn/aS3Q+Y4P+00Z9qAPi34i/8ABSP9oL4jSyiXx/c6BaPnFr4eiSxVAewkQeYR9XNAHhWu/FPxn4nkMmseLdd1WQ8l73Up5if++mNAGHFreoQSeZHfXMb/AN5JmB/PNAHa+Ff2h/ih4HmSTQPiH4o0kp0W11edUP1Xfg/iKAPpL4Wf8Favjt4Ckhj1zUNN8daepw8Ws2axzFfQTQ7Gz7sG+lAH3l8Av+Cs/wAJfirJbab4rE/w31uXCj+1JBLYOf8AZuQAF/7aKgHqaAPtez1C31CzhurW4iubaZBJHPC4ZHUjIZWGQR75xQBaByKACgAoAKACgAoA/9D9UqACgAoAKAGsxHSgD4i/ba/4KWeG/wBnSW+8IeDYrfxX8Q1BjmRiWstLY/8APcqQXkH/ADyUjH8RXgEA/G74r/GTxn8cPFU3iLxvr954g1V8hZLh/khU/wAESDCxp/sqAO/c0AZHg3wH4j+Iuuw6N4W0PUPEGrTfcs9NtmnlPqdqg4HqTxQB718Qf2BviD8FvhFd/ED4l3ekeC7NSsNlpNxc/aNQvbhslIUSLci5ALEs+VCkkcYoA+a4LaS6nSGGN5ppGCJGiksxPAAA6nOBigD6i/aH/wCCfPjv9nf4JeEfiFq7Ldx6ggXXLGKP5tFmkP7hHYEhlYEKW4CyfLzlSQD5p0CwstU1ywtNQ1AaTYTzJHPftC0ot0ZgDIUXlguckDnAOMnGQD6R+K//AATf+N3wx03+2LXw/D448PPGJo9V8Izfbo2jI3K/l4EuCpBzsIwetAHzHLDJayyRSo8UqMUZHBDKQcEEHnPagD6G/Za/bo+JH7LepwQ6TfnXPCPmbrjwzqUpNsQephbkwP8A7ScHjcrdKAP21/Zp/ar8DftSeDP7b8JXxjvYAq6jo12Qt3YSHs691PO11+VsHkEEAA9lHIoAKACgAoAKAP/R/VKgAoAKAGuSM4P/ANagD87/APgpN/wUIb4RxXnwv+HGoBfGs8e3V9Yt2ydJjYf6uMjpcMpzu/5Zrgj5yNoB+OF1cy3VzLNNI0ssjFnkdtzMSckknqSec0AfVv7AH7Hvh39q3xrdxeJPGtpo1jpZEkmgWkoXVdQXGSYgwwsQ6M43EdMDIagD9uPhN8FvBHwO8Mx6J4H8OWPh/TlA3/ZU/eTkdGllJLyN7sSaAPxX/wCCmP7T8nx++PV3ouk3bSeDvCEkmm2Cxn5J7gHFxce+WXap/uoCPvHIB6f/AMEkv2Uo/iN45uPix4kshN4f8MziLSYpl+W41HAbzB2IhBBH+26/3TQB+vHjTwdo/wAQPCureHNfsotS0fVLV7S7tZhkSIwwR7HvkcggEcigD+dH9qT4B6p+zT8atf8ABGoGSaG2k8/T7x8f6XZuSYZeO5GVb0ZWFAH6a/8ABIb9p9vH/wAPb34Ua7d+brfheMT6S8py02nFgPLHc+S7AeyyIB92gD6H/ab/AGFvhb+0xp9zcazpSaF4pKEReJdKRY7oEdPOHCzr0yH5A6MvWgD8HvjJ8PLf4U/EnXPCtr4n0nxhBps5iXWNElMltOODwf7wzhgCQGDAEjkgC/CD4w+K/gV4907xf4O1OTS9Ysm4YZ8qeMkFopU6PG2OVPsRggEAH79fsiftW+H/ANrH4Yw+IdKUafrdoVg1nRWfdJZTkZ4PVo35KPjkAjqCAAe6KcqDQAtABQAUAf/S/VKgAoAKAPmn9vT9qyD9lf4L3OpWUkTeMdZL2OhW8gBAl2/PcMO6RAhvdmRf4jQB/P5q2rXmvapd6lqN1NfX15M89xc3D75JZHYszsx6kkkknuaAO98R/s5/ETwp8KdA+JOp+F72DwXrZP2XVNoZAN21TIBzGHP3C4AftmgDhNF1vUfDOq2up6Tf3Wl6laSCW3vLOVopoXHRkdSCpHqDmgD7d8J/8Fb/AIp2Hwm8QeE/Edra69rF1p0tnpvieNvs95aSOu0Syqo2ylQTggK24AsWNAHxHo+lz6/rVlpttt+03s6W8PnOFXe7BV3MeAMnknGOaAP6Sf2cvhdoXwW+CvhTwZ4fngvbDS7NY3vLZg63MzZaabI/vyM7fQgdqAPSg3bB/I0Afnj/AMFivgtpXi/4RaV4/t7i0t/EnheYRSRyTIkt1ZTOFZVUnLFJCjDHZpKAPy3/AGcfjbqP7O/xm8M+PdNRrptLuB9pshLsF1bMNssJOCBuQnBIODg4OKAPYv2nv+Cj3xT/AGkobvRkul8G+DZ8odD0eRg1wnpcTffl46qNqHutAHytDFJcypHGrSSOwVVUbixPQY9fpQB6F8VP2ePiF8E9K8N6j418L3nh+28Q27XNg12ACQDgo4zmOQAq2xsNh1JFAG7+yj+0jrn7Lvxg0vxfpTS3On7hb6tpavtW+tGI3xnPG4YDKezKOxOQD+iTwX4z0n4g+E9H8SaDeJf6Pq1rHeWlwh4kjddynHY9iOoIIPSgDdHSgAoAKAP/0/1SoAKAGu2M4PNAH8+n/BQj9oiX9or9o3XL60uWm8NaE7aPo6g5QwxsQ8w7fvJNzZ67do7UAH7Af7LrftR/HSz03UIpD4Q0RV1LW5VOPMiDfJbg9mlYbfXaHI+7QB+/M3hvSrrw+2hz6ZZzaM1v9kbTpIFNu0O3b5Xlkbdm0Y24xjigD85/2oP+CPmh+Kbm71/4PalF4Z1B8yP4c1J2aykPXEMvLQ5/ukMuTgbAKAPy2+Kvwl8V/BHxldeFvGmjy6Jrtsqu9tJIkgKsPldWQlWUjkEGgDj89u3pQBpaP4p1jw9IX0vVb3TXJzus7l4Tn/gJFAG5cfGPx5dRGKbxt4jmiIwUfVrgr+RegDmLy/utRnM91cS3Mx6yTOXY/ieaAK5Y560Ae/fsx/sS/Ev9quV7jwrY21p4dt7g2t3r2pTiO2gcKGKADLu21gcKp6jJGc0Afrp+yj/wTj+G/wCzM9prc8Z8ZeOIgGGu6nCFW2b/AKdoMlYv94ln64YA4oA9X/ai/Z40X9pr4O614J1dY4p5k87Tb9l3NY3ig+VMO+MkhgOqMw70AfzoeMfCeq+BPFer+HNbtXstW0q7ksru3f8A5ZyoxVh+Y4PcYNAH6nf8Eaf2i5NV0XXvg9q90ZJtNDaxonmNk+QzAXEI/wB12VwP+mjntQB+nq8AUALQAUAf/9T9UqACgDwf9uT4uP8ABT9lzx94jtpvJ1NrE6fYMp+Zbi4Pkoy+67y//AKAP50weff1oA/eL/glx8DYvhD+y7o+qXNsI9c8XsNbunZcMIWGLZPoIsPjsZWoA+wQARQA1wCD/nmgD+dr9vbx43xE/a++KGpiUyw2+rvpkPOQEtQLcY9iYifxoA+sv+CcH7CPw4/aJ+AOueJviDo9zdXlxrb2un3Vrey28kMMUUe4gKdrZd2+8p+59aAPZ9e/4Iq/Cq8meTSfGXi3SweQlw9tcKPp+6U/maAMGH/giN4NWTMvxL154/7qafAp/Pcf5UAdv4U/4I2fBPQ5Fl1bVfFXiE55iuL+KCJvYiKNW/JqAPzu/wCCi3wB0D9nb9pG68P+FNPfS/DV5plpqFhaNK8oRShjkG9yWOZIpDyf4qAPrH/giN46YS/E7wZI5KEWmsW6ZPX5oZTj6GH9KAP1WAA6CgBNox0oA/G7/gsn8DY/CHxc0D4j6bb+XZeKbc2uoFBwLy3CgMfd4in18pj3oA+R/wBk34tSfA/9orwJ4w80xWdlqUcd9hutpL+6nB9f3bsR7gUAf0kRncgIOe+fWgB1ABQB/9X9UqACgD83/wDgtj40k034RfD/AMMRylP7W1qW+dQcblt4duD7brgH8KAPyX8BeF5fHHjfw94ctyRPrGo2+nxlRzulkWMY/FhQB/TzoekWvh/RrHTLKLybOygS2gjHRURQqgfgooAv/wCelAEN3OlrbyTSHbHGpdiewAz/AEoA/l28Wa2/ifxTrGsSkvLqF7Ndsx6kySM5J/OgD97/APgmj4aTwz+xZ8OEC7ZLyC5v5Ce/m3MrA/8AfO38qAPp8ce34UAH+elABjrQB+R3/Bbzw4Lbxz8LteCndeabe2LNjtDLHIB/5HNAHl3/AAR78Rvo/wC1s9h5hVNW0C9tSn94oY5h/wCijQB+4X+elAC/56UAfHn/AAVb8AR+Nv2PPEV95Yku/Dl5aatAdvzDEghkwe37udz+FAH4PdCeh5xQB/Sr+zB40f4h/s7/AA38RSuXuL/QLOS4YnJMwiVZP/H1agD0+gAoA//W/VKgAoA/JD/gt7fNJ40+FdmSdkWnX8wHbLywg/ogoA/OPwV4w1T4f+LdG8S6JOltrOkXcV9ZzPEsojmjYMjbWBU4IBwQRxQB9Nn/AIKqftKA/wDI9Ww/7glj/wDGaAE/4eqftKf9D1bf+CSx/wDjNAEN9/wVG/aO1KxntbjxxbvDPG0TgaJZAlWGDgiL0oA+USeT2+lAH0v4D/4KN/Hn4Z+DdH8K+HvF9vY6HpFslpZ250ezkMca/dG5oizfUkmgDe/4eqftKdvHVt/4I7H/AOM0AJ/w9U/aU/6Hq2/8Elj/APGaAD/h6p+0p/0PVt/4JLH/AOM0AeVfHn9rL4nftL2mjQfELXotai0h5XsxHYQWxjMgUPzEi5yEXrnpQByXwj+L3in4GeOrLxh4N1FNL1+zSRIbloI5gqyIUcFJAVOVYjkfSgD6DP8AwVU/aU/6Hq2/8Elj/wDGaAE/4eqftKf9D1bf+CSx/wDjNAGD49/4KM/Hn4neDdY8K+I/F1tf6Jq9s1peW40izjLxt1AZYgy/UEGgD5p7j1oA/oJ/4Jq37ah+xH8MpGJLJbXcOT6JezqP0FAH05QAUAf/1/1SoAKAPyY/4LgaVJH4l+E2o7T5U1nqNuW90kgbH/j9AH50fDDwUPiR8R/C3hM6hFpJ1zVLbTRezKWSBppFjDsB1ALCgD9CP+HInis/81P0Yf8AcLn/APi6AD/hyJ4r/wCioaN/4K5//i6AK2p/8EUfFmnabd3Q+JmkTGCF5RGulzAvtUnGd/fGKAPzbwCeM8+lAH3z8F/+CSev/Gn4VeF/HFj8RdKsLbXbFL1LWXTpXaLd1QsHAJBBFAHan/giH4rz/wAlQ0b/AMFc/wD8XQAn/DkTxX/0VDRv/BXP/wDF0AH/AA5E8V/9FQ0b/wAFc/8A8XQB82/tl/sN6n+x1a+FJdU8WWPiN9fe5WOO0tJIfKEIjJJ3E5z5oHHpQB5x+zH8Ab79pn4v6X4B0/VYNFnvYbif7bcxNKkaxRNIcqpBOduPxoA+2f8AhyH4r/6Kho3/AIK5/wD4ugA/4cieK/8AoqGjf+Cuf/4ugDiPjd/wSZ174H/CjxP461H4jaTfWmhWTXbWsWnyxvMQQqoGLEAlmUZ96APgjo+DzigD+g//AIJw6W+j/sU/C6B1KtJYz3OD3El1NID+TCgD6VHSgAoA/9D9UqACgD89/wDgtB4Ek139n/wx4mhTe+g66scp/uQ3ETKT/wB/EiH4igD8cvD2tXHhvXdO1azbZeWFzFdQsDjDowZf1UUAf07eAvFtl8QPBOgeJtOZZLDWbCDUIGXkFJY1cfo1AG/gelAEcqKylWUMDwR+lAH8wPxH8Ov4P+IfijQJF2vpWqXViwHYxzMh/wDQaAP3S/4Jd+Kl8TfsW+BkyDNpj3mnSYOcFLmRlH/fDpQB9X4FAC4HpQAmB6UAfj9/wW18Trd/Fn4deHg4L6fos98yg9PPn2fni3oA47/gjX4Zk1j9qPVNUK5g0nw7cyFj2eSWGNQPqGf8jQB+2QUYHAoAXA9BQB8Pf8FeviRH4O/ZSl8PpKFu/FOqW1iIwcMYom+0SMPUAxRqf98UAfh9FE0zqiKXdjtCqOST0x9aAP6afgZ4GPw0+DXgfwoy7ZNG0SzsZB/00SFVc/iwJoA7mgAoA//R/VKgAoA8q/ak+Eo+OfwA8c+CVRXutU02QWe4cC6T95Afb94iZ9iaAP5s7y2msLua2uI3gnhcxyRSDDIwOCCOxBHSgD9qv+CQ3x+j+IfwFm8AX1yG1zwbMY4kY/NJYSszRMPUI/mJ7AJ6igD73FADHJ5+lAH8+v8AwUe8A/8ACAftjfEO3jULbandJrEJX+IXESyucdv3hcfhQB6J+xN/wUWg/ZG+E3iDwpc+E7nxVNd6qdSswt6trFFuhRHVmKuesanAHc0Ad9rn/BbH4j3DsdG8A+FrCPsL2S5umH4q8Y/SgDBg/wCC0PxrjmDSeHPBE0fdPsN0P1FzQB3HhX/gt14mgmQeJPhjpN/GeGbSdRltmA9QJFkB/MUAfHf7ZX7Rcf7Unxy1HxzbadPpOnyWlraWtjcuryQpHGAwLLxzI0hHsRQB97/8ESPAgt/CnxL8ZyLlry9tdJhYnGBEjSyD8TNH/wB80Afp6DkUABOKAPw6/wCCs3x9i+LH7Q6+FdMuln0XwTC2n5jOVe9chrk++0qkf1jagDyX9gb4Ov8AGz9qfwTo7wmXTNPuhrOokjKi3tiJMN7O4SP/ALaCgD+h9RgUALQAUAf/0v1SoAKAGPznpx6/pQB+GH/BU/8AZrk+DHx+n8VaZaeX4X8as+oQsi4SG9yPtMXHAyzCQe0hA+6aAPC/2VP2hNU/Zj+NOh+NtPEtzZwt9n1OwRgPtlm5AljGeM8BlJ/iRfpQB+9/iH9p/wCGvhT4OWHxQ1TxVZ2vg7ULZbmyu2bL3O4ZEUcY+Z5eoKAZBU5xg4APyu/ag/4K2ePPidcXWjfDJJvAPho7kGoAhtVuV/vbwSIOO0eWH9/tQB8F6pql7q+oT319dz3t5cOZJbi5laSSRjyWZm5J9zQAadp91qt7b2dnBLd3dzIsUNvAhd5ZGICqoHJJJAAGTzQB7/4d/wCCe37RHimNJLL4V6zAjYP/ABMWhsmH1WaRCPxFAHSXP/BLn9pW3g8z/hXqy4Gdkes2LN+XnUAeYfEf9kb4x/CTSLnVfFvw613SdKtgDPqBt/OtoQSFBeWPcqjJA5PcCgDyHODxQB2Pww+L/jT4M+II9c8E+JdR8N6khG6WxmKpIP7siH5JF/2XBB9KAP1H/ZM/4K76V4rnsfDPxmgtvDupuRFF4os12WMrdB9oj5MJPHzrlMkkhAKAPo39uj9sHS/2avghJquk31teeLPEMLW/h2KNxIrll5uuOGjjVlbPRiUXvmgD8A7y9uNSvLi6uppLi5nkaWWaZizO5OSzE9SSSSevNAH7O/8ABIr9mx/hn8Ib34j6zamHXvGIQ2ayDDQ6chzGfbzXy/uqxmgD9AB0oAKACgD/0/1SoAKADAznvQB5J+1F+z1on7TXwf1rwTrG2CadftGnX+3c1ldoD5UwHcZJVh3VmGRmgD+d/wCJvw18QfCLx5rXhHxTYPpuuaVcNBcwNyvHIZG/iRlwysMghge9AGFd65qN5p1np1xf3Nxp9kZDa2skzNFAXIMmxScLuIBOOpAzmgDsvgv8CvG37QHiyPw74H0G41vUDhpnTCQ20ef9ZNIfljX3Y8ngAnigD9J/Cf8AwRi0jSvhPr7eJPE02t/Ea506UacliTBp1ld7Mxg5+eYbgFLNtGGPyZANAH5UT22oeGdbkgmSbTtU0+4Mbo2UlgmRsEHuGVh+BFAH9Ev7Gvx/t/2k/wBn/wAN+LjJGdYWL7Fq8S9Yr2MASZHYP8sg/wBmQUAe3H8PbNAH5i/8Flf2iE07w9oXwe0i4H2jUSmr635Z+7AjEW8Tf7zgyEdf3aetAHwj+xJ+zmf2nP2gtA8K3cMr+HoSdQ1uWJihWzjwWXcOVMjFIweuXyOlAH1d+0//AMEe9b8KQ3ev/B7UpfE2nx5lfw3qTKt9GvUiGXhZsf3DtbsC5NAH5x6rpd9oOpXOn6laXFhqFrI0Nxa3UbRywupwUZWAKkEEEGgB19rWo6tBY297fXV5BYw/ZrSKaZpFt49zN5cYJwq7mZsDAyxPc0AfTH/BP/8AY+vf2p/itHJqcE0XgDQpEuNZuwCBOfvJaI3998c45VNx4JXIB++9hY2+nWUFrawR21tAixRQwoERFUAKqqOAAAAAOgFAFigAoAKAP//U/VKgAoAKAEKg9aAPkv8Abz/YV0j9q7wquqaSbfSPiNpcJXT9Rk+WO6j5P2acgfdJPytyUJ44LAgH4W+OPAmvfDbxVqXhvxPpN1ouu6fKYbmyu02vG3b2IIwQwJBGCCQQaAPZf2Tv20PHX7JGuzyeH/I1bw3fSrJqOg3oxDcEDHmI4G6OQDgMMjGNysAAAD9h/wBnP/goJ8Iv2iYLa0stcj8M+KJVCvoGuusExf8AuwuTsmGc42HdjkqvSgD8+/8AgrX+ytJ8OviZH8VNAsinhnxVJt1IRL8lrqWMljjoJlBcf7ayeooA89/4Jp/taR/s3/GI6P4hvDB4F8UMlpfySH93ZXGcQ3R9FGSr/wCy2TnYBQB+z3xy+NXh74BfCzWvHXiKcf2bp0O6OCNx5l5KeIoY89XdiAPTljwDgA/nN+LXxP1v4z/EnxB418Q3H2jV9ZunuZSCdsanhI0z0RFCoo9FFAH7Mf8ABNv9nSy/Zd+AM3jDxm1ro3iPxPGmoahc6hIsS2FkBmCF3bAThi75x8zgH7lAHLftP/8ABXHwN8O7a80T4WpH488R4Mf9qOGTSrZsEZ3ZDTkccJhDkfPxigD8jPid8TvE3xk8can4u8XanJq+vak4e4uXVUHAAAVVACqFAAAGAAKAPTf2S/2QfGH7WHjldM0aJtO8PWbqdX8QTRkwWUfoOm+UjO2MdepwoJoA/fP4L/Brwv8AAf4eaV4N8I6eLDSLBercy3Ep+/NK2BudjyT06AYUAAA7kDAwKACgAoAKAP/V/VKgAoAKACgBGQN1GaAPBf2qf2NPAP7V3h8W3iS2OneILaMpp3iKxRRd23fa2f8AWx55Mbe+CpOaAPxf/aZ/YU+KP7MN9cXOs6Udb8Jh/wBz4k0lGktSM8CUfegbth8DOQrPjNAHzufl4GT+FAHo9t+0d8SovAWpeCJvGGp6l4Rv4hDNo2pyi7t1AIKmMShvKZWCkMm0gjg0AealyeM8UAeo/Ef9pP4gfFr4d+DfBfifXJNS0HwpG0WnwsPmbPCtKc/vGRMRqSPlUY7kkA8/8P67deF9dsNXsfKF7YzpcwGeFJkEiEMpKOCrYIHDAg9waAOo+Jnxz+IHxkvftPjXxhrHiRw25I7+6Z4Yz/sRZ2J1/hAoA46xtJ9QuobW3hkuLiZxHHFEhdnYnAAAyTz2HWgD77/ZO/4JP+MfibcWfiD4pi58E+FiRKulcLql2vUAqQRbqeeXG/g4UcNQB+vfw4+Gfhf4S+EbDwx4Q0S10HQrJdsNnaLgZ7sxPLOepdiWJ5JNAHUAADA4FABQAUAFABQB/9b9UqACgAoAKACgBCoPWgBk9vHcwvFKiyRSKVdHGVYHqCO4PpQB8k/G/wD4Jf8AwP8AjHJcXtrokvgbWZTk3nhllgiZuvzW7AxYz12qpPrQB8WfEX/giv8AELR5ZZfBnjXQfElsCSsWpRy2E+PQYEiE9uWFAHy38cv2JPjB+zr4fGveN/DEen6E1wlquoQahbzo0rhiq7UcvyEbqoHFAHhmPQ0AfXXgz/glb+0J4xhtrh/DWnaHaXCK6XGqavBt2kZBKxNI4GCDjbmgD6U+F3/BEs+dDcfET4iKYwRvsPDNty30uJun/fo0Afd3wM/Y7+Ev7O8aSeDPCFpbaoF2trN5m5vmz1/fPkoD3VNo9qAPaNooAKACgAoAKACgAoA//9f9UqACgAoAKACgAoAKADFABigD4Z/4LFDH7JEJ/wCpksv/AEXPQB+H4JoA/qP8IgHwto+ef9Dh6/8AXNaANfFABQAUAFABQAUAFABQAUAf/9D9UqACgBMmgA5/yKADn/IoAOf8igA5/wAigA5/yKAELEHnp7CgD8zv+CwH7RXgjUPhxD8JrLVP7Q8Zx6rbaheWtou+OxjRJOJnHCuwkUhBlscsBlcgH5HhRnpx09aAP6Qv2Xv2hvBP7RHwzsNX8G6p9qFnDFbX1jcLsurKUIPllTtnBIYEq2DtJwaAPYASRQAc/wCRQAc/5FABz/kUAHP+RQAc/wCRQAuaACgAoA//0f1SoA+af+Cgvx48Vfs5/s+XHjDwdNawawmp2tqGvbcTR7HLbhtJ68CgD8xT/wAFd/2gc/8AH/4e/wDBMn/xVACf8Pd/2gf+f/w9/wCCZP8A4qgA/wCHu/7QP/P/AOHv/BMn/wAVQAf8Pd/2gf8An/8AD3/gmT/4qgA/4e7/ALQP/P8A+Hv/AATJ/wDFUAH/AA93/aB/5/8Aw9/4Jk/+KoARv+Cun7QTK2NR0BCRgMujpkcdRyef8KAPGf2a/ghrn7X/AO0Fa+Gp9YkhuNUkn1PV9anHmyJEpLzS4JG52ZgBk/ecZ4oA/R/4s/8ABG/4dS/Di8TwDq2u2XjC1t2e0l1S8S4gvJVUkRyqI127sY3JjbnOCOKAPzE+A/7Qnjr9mDxxc6/4MvlsNSaB7G6t7qLzIZUzkrJGTglWUEHqCPc5APoQ/wDBXf8AaBz/AMf/AIfP/cGT/wCKoAT/AIe7/tA/8/8A4e/8Eyf/ABVAB/w93/aB/wCf/wAPf+CZP/iqAD/h7v8AtA/8/wD4e/8ABMn/AMVQAf8AD3f9oH/n/wDD3/gmT/4qgA/4e7/tA/8AP/4e/wDBMn/xVAD4v+Cuv7QTOo+3eHyCQMDR0Hf/AHjQB+42nzPPY28j4LvGrMVGBkjnFAFigD//0v1SoA+av+CgnwI8U/tF/s+zeEPB8drLrL6na3QW8uBAnlxltx3EHkZoA/MT/h0P+0Celn4c/wDBwv8A8TQAf8Ohv2gf+fPw7/4OF/8AiaAD/h0N+0D/AM+fh3/wcL/8TQAf8Ohv2gf+fPw7/wCDhf8A4mgA/wCHQ37QP/Pn4d/8HC//ABNAB/w6G/aB/wCfPw7/AODhf/iaAB/+CRP7QKRkix8PuwHCrq6kn2Hy49uvfnHWgDxf9mv43a7+x7+0DaeJp9IeW50qWbTdY0W4JhkeMnZNESR8jqygjI+8gzkZoA/R74r/APBZL4dw/Dm8bwFo2u3vjC6gaO0i1S1jggs5GUgPKwkbdsJB2rndgDK9aAPzG+A/7Pfjn9p/xvc6B4MsUv8AUY4JL66uLuXyoIUB+9JIcgFmYADqSfY0AfQh/wCCQ/7QJP8Ax5+Hf/Bwv/xNACf8Ohv2gf8Anz8O/wDg4X/4mgA/4dDftA/8+fh3/wAHC/8AxNAB/wAOhv2gf+fPw7/4OF/+JoAP+HQ37QP/AD5+Hf8AwcL/APE0AH/Dob9oH/nz8O/+Dhf/AImgB0f/AASJ/aBWRT9i8PYBB41hc9e3y0AfuNp0TQWNvG2NyRqpx0yBQBYoA//T/VKgAIB680AGKADAoAMCgAwKADAoAMCgBGUEHI4oA+R/2sv+Cc3w5/ad1a48RCa48HeNGjUy6zpsayR3eOF+0QHAkIAxuDK2MAkgCgD4o+G3/BJmz8XeNJtJvvibMlpasfMa30MLJIq9QpNwQpPrg49DQB+nn7PP7NngX9mXwZ/wjngnTDbRysJL3ULlhJd30iggPNJgZxk4UAKuTgDJyAeqAADGKADAoAMCgAwKADAoAMCgAwKAADFABQB//9k\u003d"
  },
  "description": "This client allows you proxy any file thru the tag manager. This is useful if you need to server some js files from your domain.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "url",
    "displayName": "File URL",
    "simpleValueType": true,
    "help": "URL from which content will be loaded.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "path",
    "displayName": "Accepted File Path",
    "simpleValueType": true,
    "help": "The path that will be used for file serving.",
    "defaultValue": "/my.js",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "REGEX",
        "args": [
          "^/.*"
        ]
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "contentType",
    "displayName": "Response Content-Type",
    "simpleValueType": true,
    "defaultValue": "application/javascript",
    "help": "Content-Type header value"
  },
  {
    "type": "CHECKBOX",
    "name": "useCache",
    "checkboxText": "Cache file between requests",
    "simpleValueType": true,
    "help": "Use template cache for file serving. \u003ca target\u003d\"_blank\" href\u003d\"https://developers.google.com/tag-manager/serverside/api#templatedatastorage\"\u003eMore info about this\u003c/a\u003e.",
    "defaultValue": true
  },
  {
    "type": "CHECKBOX",
    "name": "useOriginHeaders",
    "checkboxText": "Use Origin Headers for the response?",
    "simpleValueType": true,
    "defaultValue": true
  },
  {
    "type": "GROUP",
    "name": "requestGroup",
    "displayName": "Request Settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "requestTimeout",
        "displayName": "Request Timeout",
        "simpleValueType": true,
        "defaultValue": 5000,
        "valueValidators": [
          {
            "type": "NON_NEGATIVE_NUMBER"
          }
        ]
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "requestHeaders",
        "displayName": "Request Headers",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Name",
            "name": "name",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "responseGroup",
    "displayName": "Response Settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "responseStatusCode",
        "displayName": "Custom HTTP Response Code",
        "simpleValueType": true
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "responseHeaders",
        "displayName": "Response Headers",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Name",
            "name": "name",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const returnResponse = require('returnResponse');
const getRequestPath = require('getRequestPath');
const templateDataStorage = require('templateDataStorage');
const setResponseStatus = require('setResponseStatus');
const setResponseHeader = require('setResponseHeader');
const setResponseBody = require('setResponseBody');
const sendHttpGet = require('sendHttpGet');
const makeTableMap = require('makeTableMap');
const sha256Sync = require('sha256Sync');
const makeInteger = require('makeInteger');

const logToConsole = require('logToConsole');
const getContainerVersion = require('getContainerVersion');
const containerVersion = getContainerVersion();
const isDebug = containerVersion.debugMode;

const path = getRequestPath();
const cacheKey = sha256Sync(data.url);

if (path === data.path) {
    require('claimRequest')();
    runClient();
}

function runClient()
{
    if (data.useCache) {
        const cachedFile = templateDataStorage.getItemCopy('proxy_' + cacheKey);

        if (!cachedFile) {
            getFileAndReturnResponse();
        } else {
            const cachedHeaders = templateDataStorage.getItemCopy('proxy_headers_' + cacheKey) || {};

            sendResponse(200, cachedHeaders, cachedFile);
        }
    } else {
        getFileAndReturnResponse();
    }
}

function getFileAndReturnResponse()
{
    let requestSettings = {};

    if (data.requestHeaders) {
        requestSettings.headers = makeTableMap(data.requestHeaders, 'name', 'value');
    }

    if (data.requestTimeout) {
        requestSettings.timeout = data.requestTimeout;
    }

    sendHttpGet(data.url, (statusCode, originHeaders, file) => {
        if (data.responseStatusCode) {
            templateDataStorage.setItemCopy('proxy_' + cacheKey, file);
            templateDataStorage.setItemCopy('proxy_headers_' + cacheKey, originHeaders);

            sendResponse(makeInteger(data.responseStatusCode), originHeaders, file);
        } else {
            if (statusCode >= 200 && statusCode < 300) {
                templateDataStorage.setItemCopy('proxy_' + cacheKey, file);
                templateDataStorage.setItemCopy('proxy_headers_' + cacheKey, originHeaders);

                sendResponse(statusCode, originHeaders, file);
            } else {
                if (isDebug) {
                    logToConsole('Failed to download a file: ', path);
                }

                sendResponse(statusCode, originHeaders, file);
            }
        }
    }, requestSettings);
}


function sendResponse(statusCode, originHeaders, file)
{
    if (statusCode === 200) {
        if (data.useOriginHeaders && originHeaders) {
            for (let headerKey in originHeaders) {
                setResponseHeader(headerKey, originHeaders[headerKey]);
            }
        }

        if (data.responseHeaders) {
            let responseHeaders = makeTableMap(data.responseHeaders, 'name', 'value');

            for (let headerKey in responseHeaders) {
                setResponseHeader(headerKey, responseHeaders[headerKey]);
            }
        }

        if (data.contentType) {
            setResponseHeader('content-type', data.contentType);
        }
    }

    setResponseStatus(statusCode);
    setResponseBody(file);
    returnResponse();
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "return_response",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_template_storage",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_response",
        "versionId": "1"
      },
      "param": [
        {
          "key": "writeResponseAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "writeHeaderAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 22/10/2021, 20:19:38


